#!/bin/bash

set -e

rmroots() {
	echo "Cleaning $tname ($1)"

	mount -t cgroup none $tname -o "$1"

	set +e
	rmdir "$tname/oldroot"
	rmdir "$tname/newroot"
	rmdir "$tname/zdtmtstroot"
	set -e

	echo "Left there is:"
	ls "$tname"
	umount "$tname"
}

tname=$(mktemp -d cgclean.XXXXXX)

for ctl in $(cat /proc/self/cgroup | cut -d: -f2); do
	rmroots "$ctl"
done

rmdir $tname
